{% extends 'staff_hunt_base.html' %}
{% comment %}
@template: staff_hunt_puzzles.html
@description: Staff interface for managing puzzle files.
@extends: staff_hunt_base.html
@blocks:
  staff_content: The main content area displaying puzzle management interface
@context:
  puzzles: List of all Puzzle objects in the hunt
{% endcomment %}

{% block title_meta_elements %}
  {% with title="Staff Puzzles" %} {{ block.super }} {% endwith %}
{% endblock title_meta_elements %}

{% block staff_content %}
  <div class="columns"><div class="column is-12 is-12-desktop is-10-widescreen is-offset-1-widescreen is-8-fullhd is-offset-2-fullhd">
  {% for puzzle in puzzles %}
    {% if puzzle.has_gap %}
      <hr class="has-background-grey" style="height:1px">
    {% endif %}
    <div class="box p-4">
      <div class="columns is-multiline" x-data="{fileModal: false, activeTab: 'puzzle'}">
        <div class="column is-narrow has-text-grey">
          <div>#{{ puzzle.order_number }}</div>
          <div>ID: {{ puzzle.id }}</div>
          {% if puzzle.type == puzzle.PuzzleType.STANDARD_PUZZLE %}
            <span class="tag is-primary">Standard</span>
          {% elif puzzle.type == puzzle.PuzzleType.META_PUZZLE %}
            <span class="tag is-warning">Meta</span>
          {% elif puzzle.type == puzzle.PuzzleType.FINAL_PUZZLE %}
            <span class="tag is-danger">Final</span>
          {% elif puzzle.type == puzzle.PuzzleType.NON_PUZZLE %}
            <span class="tag is-info">Non-Puzzle</span>
          {% endif %}
        </div>
        <div class="column">
          <h3 class="is-size-4">{{ puzzle.name }}</h3>
        </div>
        <div class="column is-narrow">
          <div>
            <button class="button mr-1 has-tooltip-arrow has-tooltip-top"
                    data-tooltip="Manage Files"
                    @click="fileModal = true">
              <span class="icon is-small">
                <i class="fa fa-lg fa-folder-open"></i>
              </span>
            </button>
            <a href="{% url 'admin:puzzlehunt_puzzle_change' puzzle.id %}"
               class="button mr-1 has-tooltip-arrow has-tooltip-top"
               data-tooltip="Edit Puzzle">
              <span class="icon is-small">
                <i class="fa fa-lg fa-pencil"></i>
              </span>
            </a>
            <a href="{% url 'puzzlehunt:puzzle_view' puzzle.pk %}"
               class="button has-tooltip-arrow has-tooltip-top"
               data-tooltip="Preview Puzzle">
              <span class="icon is-small">
                <i class="fa fa-lg fa-eye"></i>
              </span>
            </a>
          </div>
          <div x-data="{showAnswer: false}">
            <button class="is-fullwidth button mt-2"
                    :class="showAnswer &&'is-danger is-light'"
                    @click="showAnswer = !showAnswer;"
                    x-text="showAnswer ? '{{ puzzle.answer }}' : 'Show Answer'">
            >
            </button>
          </div>
        </div>
        <!-- File Management Modal -->
        <div class="modal" :class="fileModal && 'is-active'" x-cloak @keydown.escape.window="fileModal = false">
          <div class="modal-background" @click="fileModal = false"></div>
          <div class="modal-card" style="width: 95vw;">
            <header class="modal-card-head">
              <p class="modal-card-title">{{ puzzle.name }} - File Management</p>
              <button class="delete" aria-label="close" @click="fileModal = false"></button>
            </header>
            <section class="modal-card-body">
              <!-- Tabs -->
              <div class="tabs is-boxed">
                <ul>
                  <li :class="activeTab === 'puzzle' && 'is-active'">
                    <a @click.prevent="activeTab = 'puzzle'">Puzzle Files</a>
                  </li>
                  <li :class="activeTab === 'solution' && 'is-active'">
                    <a @click.prevent="activeTab = 'solution'">Solution Files</a>
                  </li>
                </ul>
              </div>
              <!-- Tab Content -->
              <div x-show="activeTab === 'puzzle'">
                {% with parent=puzzle parent_type='puzzle'%}
                  {% include 'partials/_staff_file_list.html' %}
                {% endwith %}
              </div>
              <div x-show="activeTab === 'solution'">
                {% with parent=puzzle parent_type='solution'%}
                  {% include 'partials/_staff_file_list.html' %}
                {% endwith %}
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>
  {% endfor %}
  </div></div>
{% endblock %}